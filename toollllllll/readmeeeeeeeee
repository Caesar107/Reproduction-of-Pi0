# OpenPI æ•°æ®è½¬æ¢å’Œè®­ç»ƒæµç¨‹

## âœ… ç¬¬1æ­¥ï¼šæ•°æ®è½¬æ¢ - å·²å®Œæˆï¼

è½¬æ¢è„šæœ¬: `/home/caesar/openpi/toollllllll/transfer`

**æ³¨æ„ï¼šä½¿ç”¨ image æ¨¡å¼è€Œä¸æ˜¯ video æ¨¡å¼ï¼ˆé¿å… FFmpeg ä¾èµ–é—®é¢˜ï¼‰**

```bash
uv run python toollllllll/transfer \
  --raw-dir train_data/train \
  --repo-id caesar/my_robot_demo \
  --task "grab_bottle" \
  --robot-type "custom_robot" \
  --fps 30 \
  --mode image
```

âœ… ç»“æœï¼š
- Dataset ä½ç½®: `/home/caesar/.cache/huggingface/lerobot/caesar/my_robot_demo`
- Total episodes: 71
- Total frames: 3680

---
Pi0Config é»˜è®¤è®¾å®šåœ¨ src/openpi/models/pi0_config.py:22-33ï¼šaction_dim=32ã€action_horizon=50ã€‚è¿™ 32 ç»´æ˜¯â€œæ¨¡å‹å†…éƒ¨çš„åŠ¨ä½œæ§½ä½â€ï¼Œç”¨äºå…¼å®¹å¤šç§æœºå™¨äººï¼›ä¸è¶³çš„ä¼šåœ¨åå¤„ç†é˜¶æ®µå¡« 0ã€‚
å…·ä½“æœºå™¨äººæ—¶ï¼Œå†ç”±æ•°æ®é…ç½®æ˜ å°„çœŸå®å…³èŠ‚æ•°ã€‚ä¾‹å¦‚ ALOHA é…ç½® (src/openpi/training/config.py:563-588) é€šè¿‡ PadStatesAndActions(model_action_dim=32) æŠŠ 14 ç»´ï¼ˆåŒè‡‚å…³èŠ‚ 12 + 2 ä¸ªå¤¹çˆªï¼‰æ”¾è¿› 32 ç»´æ§½ä½ï¼›DROID çš„ 8 ç»´ï¼ˆ7 å…³èŠ‚ + 1 å¤¹çˆªï¼‰åŒç† (src/openpi/training/config.py:593-605)ã€‚
å› æ­¤ï¼Œâ€œåŸæœ¬çš„ piâ‚€â€å†…éƒ¨ä»æ˜¯ 32 ç»´åŠ¨ä½œï¼Œä½†é’ˆå¯¹å…·ä½“ robot æ—¶æœ‰æ•ˆå…³èŠ‚è‡ªç”±åº¦ç”±æ•°æ®/transform å†³å®šï¼šALOHA 14ï¼Œè‡ªç”±åº¦æ›´ä½çš„æœºå™¨äººå°±æ›´å°‘ï¼Œå‰©ä¸‹çš„ç»´åº¦ä¼šè¢« PadStatesAndActions ä¿è¯å¯¹é½è€Œä¸å‚ä¸è®­ç»ƒã€‚


## âœ… ç¬¬2æ­¥ï¼šè®¡ç®—å½’ä¸€åŒ–ç»Ÿè®¡æ•°æ® - å·²å®Œæˆï¼

é…ç½®æ–‡ä»¶ï¼š
- Data Config: `LeRobotCustomRobotDataConfig` in `src/openpi/training/config.py`
- Train Config: `pi0_custom_robot` in `src/openpi/training/config.py`
- Policy transforms: `src/openpi/policies/custom_robot_policy.py`

è¿è¡Œå‘½ä»¤ï¼š
```bash
uv run scripts/compute_norm_stats.py --config-name pi0_custom_robot
```

âœ… ç»“æœï¼š
- ç»Ÿè®¡æ•°æ®ä¿å­˜ä½ç½®: `/home/caesar/openpi/assets/pi0_custom_robot/caesar/my_robot_demo`
- å¤„ç†äº† 230 ä¸ªæ‰¹æ¬¡
- State å’Œ actions çš„å‡å€¼å’Œæ ‡å‡†å·®å·²è®¡ç®—å®Œæˆ

---

## ğŸš€ ç¬¬3æ­¥ï¼šå¼€å§‹è®­ç»ƒ

ç°åœ¨å¯ä»¥å¼€å§‹è®­ç»ƒäº†ï¼

### è®­ç»ƒå‘½ä»¤ï¼š

```bash
XLA_PYTHON_CLIENT_MEM_FRACTION=0.9 uv run scripts/train.py pi0_custom_robot \
  --exp-name=grab_bottle_experiment \
  --overwrite
```

GPU
```
CUDA_VISIBLE_DEVICES=4,5,6,7 XLA_PYTHON_CLIENT_MEM_FRACTION=0.9 \
uv run --active scripts/train.py pi0_custom_robot \
  --exp-name=grab_bottle_experiment \
  --overwrite
```


### å‚æ•°è¯´æ˜ï¼š
- `XLA_PYTHON_CLIENT_MEM_FRACTION=0.9`: å…è®¸ JAX ä½¿ç”¨æœ€å¤š 90% çš„ GPU å†…å­˜
- `pi0_custom_robot`: ä½¿ç”¨æˆ‘ä»¬åˆ›å»ºçš„é…ç½®
- `--exp-name=grab_bottle_experiment`: å®éªŒåç§°ï¼ˆæŠ“ç“¶å­ä»»åŠ¡ï¼‰
- `--overwrite`: è¦†ç›–å·²å­˜åœ¨çš„ checkpointï¼ˆé¦–æ¬¡è®­ç»ƒæ—¶ä½¿ç”¨ï¼‰

### è®­ç»ƒé…ç½®è¯¦æƒ…ï¼š
- **ä»»åŠ¡**: grab_bottle (æŠ“ç“¶å­)
- **æ¨¡å‹**: Pi0 (åŸºç¡€æ¨¡å‹ä» `gs://openpi-assets/checkpoints/pi0_base/params` åŠ è½½)
- **Action ç»´åº¦**: 7
- **Action horizon**: 10 (åŠ¨ä½œå—å¤§å°)
- **è®­ç»ƒæ­¥æ•°**: 30,000
- **Batch size**: 16
- **å­¦ä¹ ç‡**: 3e-5 (peak) â†’ 1e-6 (decay)
- **Checkpoint é—´éš”**: æ¯ 1000 æ­¥ä¿å­˜ä¸€æ¬¡

### è®­ç»ƒè¿›åº¦ä¼šï¼š
- âœ… åœ¨ç»ˆç«¯æ˜¾ç¤ºè®­ç»ƒ loss å’ŒæŒ‡æ ‡
- âœ… ä¿å­˜ checkpoints åˆ° `checkpoints/pi0_custom_robot/grab_bottle_experiment/` ç›®å½•
- âœ… è®°å½•åˆ° Weights & Biasesï¼ˆå¦‚æœå¯ç”¨ï¼‰

### ç›‘æ§è®­ç»ƒï¼š
è®­ç»ƒè¿‡ç¨‹ä¸­å¯ä»¥çœ‹åˆ°ï¼š
- Training loss
- Learning rate
- Steps per second
- ETA (é¢„è®¡å®Œæˆæ—¶é—´)

---

## ğŸ¯ ç¬¬4æ­¥ï¼šè¿è¡Œæ¨ç†

è®­ç»ƒå®Œæˆåï¼ˆæˆ–è®­ç»ƒåˆ°ä¸€å®šæ­¥æ•°åï¼‰ï¼Œå¯åŠ¨ policy serverï¼š

```bash
# ä½¿ç”¨ 20000 æ­¥çš„ checkpoint
uv run scripts/serve_policy.py policy:checkpoint \
  --policy.config=pi0_custom_robot \
  --policy.dir=checkpoints/pi0_custom_robot/grab_bottle_experiment/20000
```

Policy server ä¼šåœ¨ 8000 ç«¯å£å¯åŠ¨ï¼Œç­‰å¾…æ¥æ”¶è§‚æµ‹æ•°æ®å¹¶è¿”å›åŠ¨ä½œã€‚

### æµ‹è¯•æ¨ç†ï¼ˆå¯é€‰ï¼‰ï¼š
å¦‚æœéœ€è¦æµ‹è¯•æ¨¡å‹ï¼Œå¯ä»¥å‘é€æµ‹è¯•æ•°æ®åˆ° policy serverã€‚

---

## ğŸ“ å®Œæˆçš„ä»»åŠ¡æ¸…å•

- [x] **ç¬¬1æ­¥**: æ•°æ®è½¬æ¢ - å°† npz æ•°æ®è½¬æ¢ä¸º LeRobot æ ¼å¼
  - 71 episodes, 3680 frames
  - ä½¿ç”¨ image æ¨¡å¼ï¼ˆé¿å… FFmpeg é—®é¢˜ï¼‰
  
- [x] **ç¬¬2æ­¥**: åˆ›å»ºè®­ç»ƒé…ç½®
  - âœ… `LeRobotCustomRobotDataConfig` - æ•°æ®é…ç½®
  - âœ… `pi0_custom_robot` - è®­ç»ƒé…ç½®
  - âœ… `CustomRobotInputs/Outputs` - æ•°æ®æ˜ å°„
  
- [x] **ç¬¬3æ­¥**: è®¡ç®—å½’ä¸€åŒ–ç»Ÿè®¡
  - âœ… State å’Œ actions çš„å‡å€¼/æ ‡å‡†å·®å·²ä¿å­˜
  
- [ ] **ç¬¬4æ­¥**: å¼€å§‹è®­ç»ƒ â¬…ï¸ **å½“å‰æ­¥éª¤**
- [ ] **ç¬¬5æ­¥**: æµ‹è¯•æ¨ç†

---

## ğŸ’¡ é‡è¦æç¤º

### æ•°æ®æ˜ å°„è¯´æ˜ï¼š
ä½ çš„æ•°æ®è¢«æ˜ å°„ä¸ºï¼š
- `observation.state` (8ç»´) + `observation.end_effector_state` (8ç»´) â†’ `state` (16ç»´)
- `action` (7ç»´) â†’ `actions` (7ç»´ï¼Œåº”ç”¨äº† delta å˜æ¢)
- `observation.images.top` â†’ `images["top"]`
- `observation.images.wrist` â†’ `images["wrist"]`
- `task` â†’ `prompt`

### Delta Actionsï¼š
é…ç½®ä¸­ä½¿ç”¨äº† delta actionsï¼Œè¿™æ„å‘³ç€ï¼š
- å‰ 6 ä¸ªåŠ¨ä½œç»´åº¦ï¼šç›¸å¯¹äºå½“å‰çŠ¶æ€çš„å¢é‡
- ç¬¬ 7 ä¸ªåŠ¨ä½œç»´åº¦ï¼ˆgripperï¼‰ï¼šç»å¯¹å€¼

å¦‚æœä½ çš„æ•°æ®å·²ç»æ˜¯ delta æ ¼å¼ï¼Œè®¾ç½® `use_delta_actions=False`

---

## ğŸ”§ æ•°æ®æ ¼å¼è¯´æ˜

ä½ çš„æ•°æ®é›†åŒ…å«ï¼š
- `observation.state`: å…³èŠ‚çŠ¶æ€ (8ç»´)
- `observation.end_effector_state`: æœ«ç«¯æ‰§è¡Œå™¨çŠ¶æ€ (8ç»´)
- `action`: åŠ¨ä½œ (7ç»´)
- `observation.images.top`: é¡¶éƒ¨æ‘„åƒå¤´å›¾åƒ (256x256)
- `observation.images.wrist`: è…•éƒ¨æ‘„åƒå¤´å›¾åƒ (256x256)
- `task`: ä»»åŠ¡æ ‡ç­¾ ("pen_manipulation")

éœ€è¦åœ¨é…ç½®ä¸­æ˜ å°„åˆ°æ¨¡å‹æœŸæœ›çš„æ ¼å¼ã€‚


